CREATE TABLE USERS (USER_ID BIGINT NOT NULL, ACC_NON_EXPIRED BOOLEAN, ACC_NON_LOCKED BOOLEAN, VALID_FROM DATE, PASSWORD_NON_EXPIRED BOOLEAN, ACTIVE BOOLEAN, PASSWORD VARCHAR(100) NOT NULL, SALT VARCHAR, USER_NAME VARCHAR(50) NOT NULL UNIQUE, VER_NO BIGINT, FIRST_NAME VARCHAR NOT NULL, LAST_NAME VARCHAR, MIDDLE_NAME VARCHAR, PRIMARY KEY (USER_ID))
CREATE TABLE CONFIGURATIONS (CONFIG_ID BIGINT NOT NULL, CONFIG_VALUE VARCHAR NOT NULL, VER_NO BIGINT, CONFIG_ITEM_ID BIGINT, USER_ID BIGINT, PRIMARY KEY (CONFIG_ID))
CREATE TABLE CONFIGURATION_ITEMS (CONFIG_ITEM_ID BIGINT NOT NULL, CONFIG_ITEM_KEY VARCHAR, CONFIG_TYPE INTEGER, DEFAULT_VALUE VARCHAR, IS_KEY_VALUE_PAIR BOOLEAN, CONFIG_ITEM_TYPE INTEGER, VER_NO BIGINT, PRIMARY KEY (CONFIG_ITEM_ID))
CREATE INDEX INDEX_CONFIGURATION_ITEMS_CONFIG_ITEM_KEY ON CONFIGURATION_ITEMS (CONFIG_ITEM_KEY)
CREATE TABLE SESSION_REGISTRY (ITEM_ID BIGINT NOT NULL, EXPIRED BOOLEAN, LAST_REQUEST_TIME TIMESTAMP, SESSION_ID VARCHAR UNIQUE, VER_NO BIGINT, PRINCIPAL BIGINT, PRIMARY KEY (ITEM_ID))
CREATE TABLE AUTHORITIES (AUTHORITY_ID BIGINT NOT NULL, AUTHORITY VARCHAR(50) UNIQUE, VER_NO BIGINT, PRIMARY KEY (AUTHORITY_ID))
CREATE TABLE EXTENSIONS (EXTENSION_ID BIGINT NOT NULL, EXTENSION_NAME VARCHAR, CLUSTER_NAME VARCHAR(1000) NOT NULL, ENTITY_NAME VARCHAR, EXTENSION_TYPE VARCHAR, TENANT VARCHAR, VER_NO BIGINT, PRIMARY KEY (EXTENSION_ID))
CREATE TABLE EXTENSIONVALUE (EXTN_VAL_ID BIGINT NOT NULL, VALUE VARCHAR, VER_NO BIGINT, EXTN_ID BIGINT, PRIMARY KEY (EXTN_VAL_ID))
CREATE TABLE WM_PARAMS (PARAM_ID BIGINT NOT NULL, AMOUNT_DECIMALS BIGINT, RATE_DECIMALS BIGINT, PERCENT_DECIMALS BIGINT, PRICE_DECIMALS BIGINT, UNIT_DECIMALS BIGINT, VER_NO BIGINT, PRIMARY KEY (PARAM_ID))
CREATE TABLE TRANSACTIONS (TRAN_ID BIGINT NOT NULL, AMOUNT NUMERIC(38) NOT NULL, BROKERAGE NUMERIC(38), EXCHANGE VARCHAR NOT NULL, OTHER_CHRGS NUMERIC(38), PRICE NUMERIC(38) NOT NULL, QUANTITY NUMERIC(38) NOT NULL, TOTAL_AMOUNT NUMERIC(38) NOT NULL, TRADE_DATE DATE NOT NULL, TRADED BOOLEAN NOT NULL, TRANSACTION_TYPE VARCHAR NOT NULL, VER_NO BIGINT, BROKER_ID BIGINT, INSTRUMENT_ID BIGINT NOT NULL, PORTFOLIO_ID BIGINT, PRIMARY KEY (TRAN_ID))
CREATE TABLE STOCK_PREFERENCE (FAV_STOCK_ID BIGINT NOT NULL, BUY_PRICE NUMERIC(38), DESCRIPTION VARCHAR, LNG_TARGET_PRICE NUMERIC(38), TARGET_PRICE NUMERIC(38), VER_NO BIGINT, USER_ID BIGINT NOT NULL, STOCK_ID BIGINT, PRIMARY KEY (FAV_STOCK_ID))
CREATE TABLE PORTFOLIO (PORTFOLIO_ID BIGINT NOT NULL, PORTFOLIO_NAME VARCHAR NOT NULL, VER_NO BIGINT, WEALTH_CONTEXT_ID BIGINT NOT NULL, PRIMARY KEY (PORTFOLIO_ID))
CREATE TABLE INSTRUMENTS (INSTRUMENT_ID BIGINT NOT NULL, INSTRUMENT_TYPE VARCHAR(31), INSTRUMENT_CODE VARCHAR, INSTRUMENT_GROUP VARCHAR, ISIN VARCHAR, INSTRUMENT_NAME VARCHAR NOT NULL, INSTRUMENT_SYMBOL VARCHAR NOT NULL, VER_NO BIGINT, PRIMARY KEY (INSTRUMENT_ID))
CREATE TABLE HOLDINGS (HOLDING_ID BIGINT NOT NULL, AMOUNT NUMERIC(38) NOT NULL, BROKERAGE NUMERIC(38), PRICE NUMERIC(38) NOT NULL, PROFIT NUMERIC(38), QUANTITY NUMERIC(38) NOT NULL, TOTAL_AMOUNT NUMERIC(38) NOT NULL, VER_NO BIGINT, BROKER_ID BIGINT, INSTRUMENT_ID BIGINT NOT NULL, PORTFOLIO_ID BIGINT, WEALTH_CONTEXT_ID BIGINT NOT NULL, PRIMARY KEY (HOLDING_ID))
CREATE TABLE EQUITIES (INSTRUMENT_ID BIGINT NOT NULL, STOCK_EXCHANGE VARCHAR, MTM_CANDIDATE BOOLEAN, NSE_CODE VARCHAR, PRIMARY KEY (INSTRUMENT_ID))
CREATE TABLE BROKERAGE_STRUCTURES (EXPENSE_ID BIGINT NOT NULL, BROKERAGE NUMERIC(38), INSTITUTION VARCHAR, MIN_BROKERAGE NUMERIC(38), OTHER_CHARGES NUMERIC(38), SERVICE_TAX NUMERIC(38), TRANSACTION_TAX NUMERIC(38), VER_NO BIGINT, PRIMARY KEY (EXPENSE_ID))
CREATE TABLE USER_WEALTH_CONTEXT (WEALTH_CONTEXT_ID BIGINT NOT NULL, VER_NO BIGINT, USER_FK BIGINT UNIQUE, PRIMARY KEY (WEALTH_CONTEXT_ID))
CREATE TABLE MTMS (MTM_ID BIGINT NOT NULL, CLOSE_PRICE NUMERIC(38), DAYS_HIGH NUMERIC(38), DAYS_LOW NUMERIC(38), LAST_TRADED_PRICE NUMERIC(38), OPEN_PRICE NUMERIC(38), PREVIOUS_CLOSE NUMERIC(38), SERIES VARCHAR, SYMBOL VARCHAR, TOTAL_TRADED_QTY NUMERIC(38), TOTAL_TRADED_VALUE NUMERIC(38), TRADE_DATE DATE, VER_NO BIGINT, INSTRUMENT_ID BIGINT, PRIMARY KEY (MTM_ID))
CREATE TABLE JOB_UNIQUE_INSTANCE (ID BIGINT NOT NULL, END_DATE TIMESTAMP, NAME VARCHAR UNIQUE, OWNER VARCHAR, START_DATE TIMESTAMP, STATUS VARCHAR, VER_NO BIGINT, PRIMARY KEY (ID))
CREATE TABLE USER_AUTHORITIES (USER_ID BIGINT NOT NULL, AUTHORITY_ID BIGINT NOT NULL, PRIMARY KEY (USER_ID, AUTHORITY_ID))
CREATE TABLE FAV_STOCKS (USER_ID BIGINT NOT NULL, STOCK_ID BIGINT NOT NULL, PRIMARY KEY (USER_ID, STOCK_ID))
ALTER TABLE CONFIGURATIONS ADD CONSTRAINT UNQ_CONFIGURATIONS_0 UNIQUE (USER_ID, CONFIG_ITEM_ID)
ALTER TABLE CONFIGURATION_ITEMS ADD CONSTRAINT UNQ_CONFIGURATION_ITEMS_0 UNIQUE (CONFIG_ITEM_KEY)
ALTER TABLE INSTRUMENTS ADD CONSTRAINT UNQ_INSTRUMENTS_0 UNIQUE (INSTRUMENT_SYMBOL)
ALTER TABLE HOLDINGS ADD CONSTRAINT UNQ_HOLDINGS_0 UNIQUE (INSTRUMENT_ID, WEALTH_CONTEXT_ID, PORTFOLIO_ID)
ALTER TABLE BROKERAGE_STRUCTURES ADD CONSTRAINT UNQ_BROKERAGE_STRUCTURES_0 UNIQUE (INSTITUTION)
ALTER TABLE MTMS ADD CONSTRAINT UNQ_MTMS_0 UNIQUE (SYMBOL, SERIES, TRADE_DATE)
ALTER TABLE CONFIGURATIONS ADD CONSTRAINT FK_CONFIGURATIONS_USER_ID FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID)
ALTER TABLE CONFIGURATIONS ADD CONSTRAINT FK_CONFIGURATIONS_CONFIG_ITEM_ID FOREIGN KEY (CONFIG_ITEM_ID) REFERENCES CONFIGURATION_ITEMS (CONFIG_ITEM_ID)
ALTER TABLE SESSION_REGISTRY ADD CONSTRAINT FK_SESSION_REGISTRY_PRINCIPAL FOREIGN KEY (PRINCIPAL) REFERENCES USERS (USER_ID)
ALTER TABLE EXTENSIONVALUE ADD CONSTRAINT FK_EXTENSIONVALUE_EXTN_ID FOREIGN KEY (EXTN_ID) REFERENCES EXTENSIONS (EXTENSION_ID)
ALTER TABLE TRANSACTIONS ADD CONSTRAINT FK_TRANSACTIONS_PORTFOLIO_ID FOREIGN KEY (PORTFOLIO_ID) REFERENCES PORTFOLIO (PORTFOLIO_ID)
ALTER TABLE TRANSACTIONS ADD CONSTRAINT FK_TRANSACTIONS_INSTRUMENT_ID FOREIGN KEY (INSTRUMENT_ID) REFERENCES INSTRUMENTS (INSTRUMENT_ID)
ALTER TABLE TRANSACTIONS ADD CONSTRAINT FK_TRANSACTIONS_BROKER_ID FOREIGN KEY (BROKER_ID) REFERENCES BROKERAGE_STRUCTURES (EXPENSE_ID)
ALTER TABLE STOCK_PREFERENCE ADD CONSTRAINT FK_STOCK_PREFERENCE_USER_ID FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID)
ALTER TABLE STOCK_PREFERENCE ADD CONSTRAINT FK_STOCK_PREFERENCE_STOCK_ID FOREIGN KEY (STOCK_ID) REFERENCES INSTRUMENTS (INSTRUMENT_ID)
ALTER TABLE PORTFOLIO ADD CONSTRAINT FK_PORTFOLIO_WEALTH_CONTEXT_ID FOREIGN KEY (WEALTH_CONTEXT_ID) REFERENCES USER_WEALTH_CONTEXT (WEALTH_CONTEXT_ID)
ALTER TABLE HOLDINGS ADD CONSTRAINT FK_HOLDINGS_BROKER_ID FOREIGN KEY (BROKER_ID) REFERENCES BROKERAGE_STRUCTURES (EXPENSE_ID)
ALTER TABLE HOLDINGS ADD CONSTRAINT FK_HOLDINGS_PORTFOLIO_ID FOREIGN KEY (PORTFOLIO_ID) REFERENCES PORTFOLIO (PORTFOLIO_ID)
ALTER TABLE HOLDINGS ADD CONSTRAINT FK_HOLDINGS_INSTRUMENT_ID FOREIGN KEY (INSTRUMENT_ID) REFERENCES INSTRUMENTS (INSTRUMENT_ID)
ALTER TABLE HOLDINGS ADD CONSTRAINT FK_HOLDINGS_WEALTH_CONTEXT_ID FOREIGN KEY (WEALTH_CONTEXT_ID) REFERENCES USER_WEALTH_CONTEXT (WEALTH_CONTEXT_ID)
ALTER TABLE EQUITIES ADD CONSTRAINT FK_EQUITIES_INSTRUMENT_ID FOREIGN KEY (INSTRUMENT_ID) REFERENCES INSTRUMENTS (INSTRUMENT_ID)
ALTER TABLE USER_WEALTH_CONTEXT ADD CONSTRAINT FK_USER_WEALTH_CONTEXT_USER_FK FOREIGN KEY (USER_FK) REFERENCES USERS (USER_ID)
ALTER TABLE MTMS ADD CONSTRAINT FK_MTMS_INSTRUMENT_ID FOREIGN KEY (INSTRUMENT_ID) REFERENCES INSTRUMENTS (INSTRUMENT_ID)
ALTER TABLE USER_AUTHORITIES ADD CONSTRAINT FK_USER_AUTHORITIES_AUTHORITY_ID FOREIGN KEY (AUTHORITY_ID) REFERENCES AUTHORITIES (AUTHORITY_ID)
ALTER TABLE USER_AUTHORITIES ADD CONSTRAINT FK_USER_AUTHORITIES_USER_ID FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID)
ALTER TABLE FAV_STOCKS ADD CONSTRAINT FK_FAV_STOCKS_USER_ID FOREIGN KEY (USER_ID) REFERENCES USER_WEALTH_CONTEXT (WEALTH_CONTEXT_ID)
ALTER TABLE FAV_STOCKS ADD CONSTRAINT FK_FAV_STOCKS_STOCK_ID FOREIGN KEY (STOCK_ID) REFERENCES INSTRUMENTS (INSTRUMENT_ID)
CREATE TABLE ID_GEN (ID_NAME VARCHAR(50) NOT NULL, ID_VAL NUMERIC(38), PRIMARY KEY (ID_NAME))
INSERT INTO ID_GEN(ID_NAME, ID_VAL) values ('HOLDING_SEQ', 0)
INSERT INTO ID_GEN(ID_NAME, ID_VAL) values ('FAV_STOCK_SEQ', 0)
INSERT INTO ID_GEN(ID_NAME, ID_VAL) values ('INSTRUMENT_SEQ', 0)
CREATE TABLE SEQUENCE (SEQ_NAME VARCHAR(50) NOT NULL, SEQ_COUNT NUMERIC(38), PRIMARY KEY (SEQ_NAME))
INSERT INTO SEQUENCE(SEQ_NAME, SEQ_COUNT) values ('AUTH_GEN', 0)
INSERT INTO SEQUENCE(SEQ_NAME, SEQ_COUNT) values ('WM_PARAMS_GEN', 0)
INSERT INTO ID_GEN(ID_NAME, ID_VAL) values ('TXN_SEQ', 0)
INSERT INTO ID_GEN(ID_NAME, ID_VAL) values ('BROKERAGE_SEQ', 0)
INSERT INTO ID_GEN(ID_NAME, ID_VAL) values ('FOLIO_SEQ', 0)
INSERT INTO SEQUENCE(SEQ_NAME, SEQ_COUNT) values ('JOB_UNIQ_GEN', 0)
INSERT INTO SEQUENCE(SEQ_NAME, SEQ_COUNT) values ('EXTENSION_GEN', 0)
INSERT INTO SEQUENCE(SEQ_NAME, SEQ_COUNT) values ('CONFIG_ITEM_GEN', 0)
INSERT INTO ID_GEN(ID_NAME, ID_VAL) values ('MTM_SEQ', 0)
INSERT INTO SEQUENCE(SEQ_NAME, SEQ_COUNT) values ('CONFIG_GEN', 0)
INSERT INTO SEQUENCE(SEQ_NAME, SEQ_COUNT) values ('EXTN_VAL_GEN', 0)
INSERT INTO ID_GEN(ID_NAME, ID_VAL) values ('WEALTH_CONTEXT_SEQ', 0)
INSERT INTO SEQUENCE(SEQ_NAME, SEQ_COUNT) values ('SESSION_REGISTRY_GEN', 0)
INSERT INTO SEQUENCE(SEQ_NAME, SEQ_COUNT) values ('USER_GEN', 0)
